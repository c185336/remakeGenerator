<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>remakeGenerator &bull; remakeGenerator</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">remakeGenerator</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>remakeGenerator</h1>
                        <h4 class="author">Will Landau</h4>
            
            <h4 class="date">2016-11-20</h4>
          </div>

    
    
<div class="contents">
<p>The <code>remakeGenerator</code> package is a helper add-on for <a href="https://github.com/richfitz/remake"><code>remake</code></a>, a <a href="https://www.gnu.org/software/make/">Makefile</a>-like reproducible build system for R. If you haven&rsquo;t done so already, go learn <a href="https://github.com/richfitz/remake"><code>remake</code></a>! Once you do that, you will be ready to use <code>remakeGenerator</code>. With <code>remakeGenerator</code>, your long and cumbersome workflows will be</p>
<ul><li><strong>Quick to set up</strong>. You can plan a large workflow with a small amount of code.</li>
<li><strong>Reproducible</strong>. Reproduce computation with <code>remake::make()</code> or <a href="https://www.gnu.org/software/make/">GNU Make</a>.</li>
<li><strong>Development-friendly</strong>. Thanks to <a href="https://github.com/richfitz/remake"><code>remake</code></a>, whenever you change your code, your next computation will only run the parts that are new or out of date.</li>
<li><strong>Parallelizable</strong>. Distribute your workflow over multiple parallel processes with a single flag in <a href="https://www.gnu.org/software/make/">GNU Make</a>.</li>
</ul><p>The <code>remakeGenerator</code> package accomplishes this by generating <a href="http://yaml.org/">YAML</a> files for <a href="https://github.com/richfitz/remake"><code>remake</code></a> that would be too big to type manually.</p>
<div id="rtools-for-windows-users" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#rtools-for-windows-users" class="anchor"> </a></body></html>Rtools for Windows users</h1>
<p>Windows users may need <a href="https://github.com/stan-dev/rstan/wiki/Install-Rtools-for-Windows"><code>Rtools</code></a> to take full advantage of <code>remakeGenerator</code>&rsquo;s features, specifically to run <a href="https://www.gnu.org/software/make/">Makefiles</a> with <code>system("make")</code>.</p>
</div>
<div id="help-and-troubleshooting" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#help-and-troubleshooting" class="anchor"> </a></body></html>Help and troubleshooting</h1>
<p>Use the <code><a href="../reference/help_remakeGenerator.html">help_remakeGenerator()</a></code> function to obtain a collection of helpful links. For troubleshooting, please refer to <a href="https://github.com/wlandau/remakeGenerator/blob/master/TROUBLESHOOTING.md">TROUBLESHOOTING.md</a> on the <a href="https://github.com/wlandau/remakeGenerator">GitHub page</a> for instructions.</p>
</div>
<div id="basic-example" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#basic-example" class="anchor"> </a></body></html>Basic example</h1>
<p>Write the files for the <a href="https://github.com/wlandau/remakeGenerator/tree/master/inst/examples/basic">basic example</a> using</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(remakeGenerator)
<span class="kw"><a href="../reference/example_remakeGenerator.html">example_remakeGenerator</a></span>(<span class="st">"basic"</span>)
<span class="co"># list_examples_remakeGenerator() # Shows the names of available examples.</span></code></pre></div>
<p>Run <a href="https://github.com/wlandau/remakeGenerator/blob/master/inst/examples/basic/workflow.R"><code>workflow.R</code></a> to produce the required <a href="https://github.com/richfitz/remake"><code>remake</code></a> file <code>remake.yml</code>, along with the optional <a href="https://www.gnu.org/software/make/">Makefile</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">source</span>(<span class="st">"workflow.R"</span>)</code></pre></div>
<p>Then, run the full example directly through <a href="https://github.com/richfitz/remake"><code>remake</code></a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">remake::<span class="kw">make</span>()</code></pre></div>
<p>or indirectly through the <a href="https://www.gnu.org/software/make/">Makefile</a> (which calls <code>remake::make()</code> on <code>remake.yml</code> for individual targets).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system</span>(<span class="st">"make"</span>)</code></pre></div>
<p>Alternatively, distribute the work over four parallel processes with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system</span>(<span class="st">"make -j 4"</span>)</code></pre></div>
<p>Notice how <a href="https://github.com/wlandau/remakeGenerator/blob/master/inst/examples/basic/workflow.R"><code>workflow.R</code></a> and <code>remake.yml</code> rely on the functions defined in <a href="https://github.com/wlandau/remakeGenerator/blob/master/inst/examples/basic/code.R"><code>code.R</code></a>. To see how <code>remakeGenerator</code> saves you time, change the body of one of these functions (something more significant than whitespace or comments) and then run <code>remake::make()</code> again. Only the targets that depend on that function and downstream output are recomputed. If you only change whitespace or comments in <a href="https://github.com/wlandau/remakeGenerator/blob/master/inst/examples/basic/code.R"><code>code.R</code></a>, the next call to <code>remake::make()</code> will change nothing, so you can tidy and document your code without triggering unnecessary rebuilds.</p>
</div>
<div id="a-walk-through-workflow-r" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#a-walk-through-workflow-r" class="anchor"> </a></body></html>A walk through <a href="https://github.com/wlandau/remakeGenerator/blob/master/inst/examples/basic/workflow.R"><code>workflow.R</code></a></h1>
<p><a href="https://github.com/wlandau/remakeGenerator/blob/master/inst/examples/basic/workflow.R"><code>workflow.R</code></a> is the master plan of the analysis. It arranges the helper functions in <a href="https://github.com/wlandau/remakeGenerator/blob/master/inst/examples/basic/code.R"><code>code.R</code></a> to</p>
<ol style="list-style-type: decimal"><li><p>Generate some datasets.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(remakeGenerator)
datasets =<span class="st"> </span><span class="kw"><a href="../reference/commands.html">commands</a></span>(
  <span class="dt">normal16 =</span> <span class="kw">normal_dataset</span>(<span class="dt">n =</span> <span class="dv">16</span>),
  <span class="dt">poisson32 =</span> <span class="kw">poisson_dataset</span>(<span class="dt">n =</span> <span class="dv">32</span>),
  <span class="dt">poisson64 =</span> <span class="kw">poisson_dataset</span>(<span class="dt">n =</span> <span class="dv">64</span>)
)</code></pre></div></li>
<li><p>Analyze each dataset with each of two methods of analysis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">analyses =<span class="st"> </span><span class="kw"><a href="../reference/analyses.html">analyses</a></span>(
  <span class="dt">commands =</span> <span class="kw"><a href="../reference/commands.html">commands</a></span>(
    <span class="dt">linear =</span> <span class="kw">linear_analysis</span>(..dataset..),
    <span class="dt">quadratic =</span> <span class="kw">quadratic_analysis</span>(..dataset..)), 
  <span class="dt">datasets =</span> datasets)</code></pre></div></li>
<li><p>Summarize each analysis of each dataset and gather the summaries into manageable objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">summaries =<span class="st"> </span><span class="kw"><a href="../reference/summaries.html">summaries</a></span>(
  <span class="dt">commands =</span> <span class="kw"><a href="../reference/commands.html">commands</a></span>(
    <span class="dt">mse =</span> <span class="kw">mse_summary</span>(..dataset.., ..analysis..),
    <span class="dt">coef =</span> <span class="kw">coefficients_summary</span>(..analysis..)), 
  <span class="dt">analyses =</span> analyses, <span class="dt">datasets =</span> datasets, <span class="dt">gather =</span> <span class="kw"><a href="../reference/strings.html">strings</a></span>(c, rbind))</code></pre></div></li>
<li><p>Compute output on the summaries.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output =<span class="st"> </span><span class="kw"><a href="../reference/commands.html">commands</a></span>(<span class="dt">coef.csv =</span> <span class="kw">write.csv</span>(coef, target_name))</code></pre></div></li>
<li><p>Generate plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plots =<span class="st"> </span><span class="kw"><a href="../reference/commands.html">commands</a></span>(<span class="dt">mse.pdf =</span> <span class="kw">hist</span>(mse, <span class="dt">col =</span> <span class="kw">I</span>(<span class="st">"black"</span>)))
plots$plot =<span class="st"> </span><span class="ot">TRUE</span></code></pre></div></li>
<li><p>Compile <a href="http://yihui.name/knitr/"><code>knitr</code></a> reports.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">reports =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">target =</span> <span class="kw"><a href="../reference/strings.html">strings</a></span>(markdown.md, latex.tex),
  <span class="dt">depends =</span> <span class="kw">c</span>(<span class="st">"poisson32, coef, coef.csv"</span>, <span class="st">""</span>))
reports$knitr =<span class="st"> </span><span class="ot">TRUE</span></code></pre></div></li>
</ol><p>With these stages of the workflow planned, <a href="https://github.com/wlandau/remakeGenerator/blob/master/inst/examples/basic/workflow.R"><code>workflow.R</code></a> collects all the <a href="https://github.com/richfitz/remake"><code>remake</code></a> targets into one <a href="http://yaml.org/">YAML</a>-like list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">targets =<span class="st"> </span><span class="kw"><a href="../reference/targets.html">targets</a></span>(<span class="dt">datasets =</span> datasets, <span class="dt">analyses =</span> analyses, 
  <span class="dt">summaries =</span> summaries, <span class="dt">output =</span> output, <span class="dt">plots =</span> plots, <span class="dt">reports =</span> reports)</code></pre></div>
<p>Finally, it generates the <a href="https://github.com/richfitz/remake"><code>remake.yml</code></a> file and then an overarching <a href="https://www.gnu.org/software/make/">Makefile</a> via <a href="https://github.com/wlandau/parallelRemake"><code>parallelRemake</code></a>. (Write <code><a href="../reference/workflow.html">workflow(..., makefile = NULL)</a></code> to suppress the <a href="https://www.gnu.org/software/make/">Makefile</a>.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/workflow.html">workflow</a></span>(targets, <span class="dt">sources =</span> <span class="st">"code.R"</span>, <span class="dt">packages =</span> <span class="st">"MASS"</span>, 
  <span class="dt">begin =</span> <span class="kw">c</span>(<span class="st">"# Prepend this"</span>, <span class="st">"# to the Makefile."</span>))</code></pre></div>
<p>All that remains is to actually run or update the workflow with <code>remake::make()</code> or <code>system("make")</code> or <code>system("make -j 2")</code>, etc.</p>
</div>
<div id="running-intermediate-stages" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#running-intermediate-stages" class="anchor"> </a></body></html>Running intermediate stages</h1>
<p>You can run each intermediate stage by itself (conditional, of course, on the dependencies). For example, to just build the summaries and then stop, use</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">remake::<span class="kw">make</span>(<span class="st">"summaries"</span>)</code></pre></div>
<p>or</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system</span>(<span class="st">"make summaries"</span>)</code></pre></div>
<p>To remove the intermediate files and final results, run</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">remake::<span class="kw">make</span>(<span class="st">"clean"</span>)</code></pre></div>
<p>or</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">system</span>(<span class="st">"make clean"</span>)</code></pre></div>
</div>
<div id="the-framework" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#the-framework" class="anchor"> </a></body></html>The framework</h1>
<p>At each stage (<code>datasets</code>, <code>analyses</code>, <code>summaries</code>, <code>mse</code>, etc.), the user supplies named R commands. The commands are then arranged into a data frame, such as the <code>datasets</code> data frame from the <a href="https://github.com/wlandau/remakeGenerator/tree/master/inst/examples/basic">basic example</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>datasets
     target                 command
<span class="dv">1</span>  normal16  <span class="kw">normal_dataset</span>(<span class="dt">n =</span> <span class="dv">16</span>)
<span class="dv">2</span> poisson32 <span class="kw">poisson_dataset</span>(<span class="dt">n =</span> <span class="dv">32</span>)
<span class="dv">3</span> poisson64 <span class="kw">poisson_dataset</span>(<span class="dt">n =</span> <span class="dv">64</span>)</code></pre></div>
<p>Above, each row stands for an individual <a href="https://github.com/richfitz/remake"><code>remake</code></a> target, and the <code>target</code> column contains the name of the target. Each command is the R function call that produces its respective target. With the exception of &ldquo;<code>target</code>&rdquo;, each column of each data frame represents a target-specific field in the <a href="https://github.com/richfitz/remake"><code>remake.yml</code></a> file. If additional fields are needed, just append the appropriate columns to the data frame. In <a href="https://github.com/wlandau/remakeGenerator/blob/master/inst/examples/basic/workflow.R"><code>workflow.R</code></a>, the <code>plot</code> and <code>knitr</code> fields were added this way to the <code>plots</code> and <code>reports</code> data frames, respectively. Recall from <a href="https://github.com/richfitz/remake"><code>remake</code></a> that setting <code>plot</code> to <code>TRUE</code> automatically sends the output of the command to a file so you do not have to bother writing the code to save it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>plots
   target                            command plot
<span class="dv">1</span> mse.pdf <span class="kw">hist</span>(mse_vector, <span class="dt">col =</span> <span class="kw">I</span>(<span class="st">"black"</span>)) <span class="ot">TRUE</span></code></pre></div>
<p>In addition, setting <code>knitr</code> to <code>TRUE</code> knits <code>.md</code> and <code>.tex</code> target files from <code>.Rmd</code> and <code>.Rnw</code> files, respectively.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span>reports
       target                         depends knitr
<span class="dv">1</span> markdown.md poisson32, coef, coef.csv  <span class="ot">TRUE</span>
<span class="dv">2</span>   latex.tex   </code></pre></div>
<p>Above, and in the general case, each <code>depends</code> field is a character string of comma-separated <a href="https://github.com/richfitz/remake"><code>remake</code></a> dependencies. Dependencies that are arguments to commands are automatically resolved and should not be restated in <code>depends</code>. However, for <a href="http://yihui.name/knitr/"><code>knitr</code></a> reports, every dependency must be explicitly given in the <code>depends</code> field.</p>
<p>In generating the <code>analyses</code> and <code>summaries</code> data frames, you may have noticed the <code>..dataset..</code> and <code>..analysis..</code> symbols. Those are wildcard placeholders indicating that the respective commands will iterate over each dataset and each analysis of each dataset. The <code><a href="../reference/analyses.html">analyses()</a></code> function turns</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw"><a href="../reference/commands.html">commands</a></span>(<span class="dt">linear =</span> <span class="kw">linear_analysis</span>(..dataset..), <span class="dt">quadratic =</span> <span class="kw">quadratic_analysis</span>(..dataset..))
     target                         command
<span class="dv">1</span>    linear    <span class="kw">linear_analysis</span>(..dataset..)
<span class="dv">2</span> quadratic <span class="kw">quadratic_analysis</span>(..dataset..)</code></pre></div>
<p>into</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">               target                       command
<span class="dv">1</span>     linear_normal16     <span class="kw">linear_analysis</span>(normal16)
<span class="dv">2</span>    linear_poisson32    <span class="kw">linear_analysis</span>(poisson32)
<span class="dv">3</span>    linear_poisson64    <span class="kw">linear_analysis</span>(poisson64)
<span class="dv">4</span>  quadratic_normal16  <span class="kw">quadratic_analysis</span>(normal16)
<span class="dv">5</span> quadratic_poisson32 <span class="kw">quadratic_analysis</span>(poisson32)
<span class="dv">6</span> quadratic_poisson64 <span class="kw">quadratic_analysis</span>(poisson64)</code></pre></div>
<p>and <code><a href="../reference/summaries.html">summaries(..., gather = NULL)</a></code> turns</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw"><a href="../reference/commands.html">commands</a></span>(<span class="dt">mse =</span> <span class="kw">mse_summary</span>(..dataset.., ..analysis..), <span class="dt">coef =</span> <span class="kw">coefficients_summary</span>(..analysis..))
  target                                command
<span class="dv">1</span>    mse <span class="kw">mse_summary</span>(..dataset.., ..analysis..)
<span class="dv">2</span>   coef     <span class="kw">coefficients_summary</span>(..analysis..)</code></pre></div>
<p>into</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">                     target                                     command
<span class="dv">1</span>       mse_linear_normal16      <span class="kw">mse_summary</span>(normal16, linear_normal16)
<span class="dv">2</span>      mse_linear_poisson32    <span class="kw">mse_summary</span>(poisson32, linear_poisson32)
<span class="dv">3</span>      mse_linear_poisson64    <span class="kw">mse_summary</span>(poisson64, linear_poisson64)
<span class="dv">4</span>    mse_quadratic_normal16   <span class="kw">mse_summary</span>(normal16, quadratic_normal16)
<span class="dv">5</span>   mse_quadratic_poisson32 <span class="kw">mse_summary</span>(poisson32, quadratic_poisson32)
<span class="dv">6</span>   mse_quadratic_poisson64 <span class="kw">mse_summary</span>(poisson64, quadratic_poisson64)
<span class="dv">7</span>      coef_linear_normal16       <span class="kw">coefficients_summary</span>(linear_normal16)
<span class="dv">8</span>     coef_linear_poisson32      <span class="kw">coefficients_summary</span>(linear_poisson32)
<span class="dv">9</span>     coef_linear_poisson64      <span class="kw">coefficients_summary</span>(linear_poisson64)
<span class="dv">10</span>  coef_quadratic_normal16    <span class="kw">coefficients_summary</span>(quadratic_normal16)
<span class="dv">11</span> coef_quadratic_poisson32   <span class="kw">coefficients_summary</span>(quadratic_poisson32)
<span class="dv">12</span> coef_quadratic_poisson64   <span class="kw">coefficients_summary</span>(quadratic_poisson64)</code></pre></div>
<p>Setting the <code>gather</code> argument in <code><a href="../reference/summaries.html">summaries()</a></code> to <code>c("c", "rbind")</code> prepends the following two rows to the above data frame.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">    target
<span class="dv">1</span>   coef
<span class="dv">2</span>   mse

    command
<span class="dv">1</span>   <span class="kw">rbind</span>(<span class="dt">coef_linear_normal16 =</span> coef_linear_normal16, <span class="dt">coef_linear_poisson32 =</span> coef_linear_poisson32, <span class="dt">coef_linear_poisson64 =</span> coef_linear_poisson64, <span class="dt">coef_quadratic_normal16 =</span> coef_quadratic_normal16, <span class="dt">coef_quadratic_poisson32 =</span> coef_quadratic_poisson32, <span class="dt">coef_quadratic_poisson64 =</span> coef_quadratic_poisson64)
<span class="dv">2</span>   <span class="kw">c</span>(<span class="dt">mse_linear_normal16 =</span> mse_linear_normal16, <span class="dt">mse_linear_poisson32 =</span> mse_linear_poisson32, <span class="dt">mse_linear_poisson64 =</span> mse_linear_poisson64, <span class="dt">mse_quadratic_normal16 =</span> mse_quadratic_normal16, <span class="dt">mse_quadratic_poisson32 =</span> mse_quadratic_poisson32, <span class="dt">mse_quadratic_poisson64 =</span> mse_quadratic_poisson64)</code></pre></div>
<p>These top two rows contain instructions to gather the summaries together into manageable objects. The default value of <code>gather</code> is a character vector with entries <code>"list"</code>.</p>
</div>
<div id="the-commands-functions" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#the-commands-functions" class="anchor"> </a></body></html>The &ldquo;commands&rdquo; functions</h1>
<p>Functions <code><a href="../reference/commands.html">commands()</a></code>, <code><a href="../reference/commands_string.html">commands_string()</a></code>, and <code><a href="../reference/commands_batch.html">commands_batch()</a></code> help create datasets as in previous section.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/commands.html">commands</a></span>(<span class="dt">x =</span> <span class="kw">f</span>(<span class="dv">1</span>), <span class="dt">y =</span> <span class="kw">g</span>(<span class="dv">2</span>))</code></pre></div>
<pre><code>##   target command
## 1      x    f(1)
## 2      y    g(2)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">a =<span class="st"> "f(1)"</span>
b =<span class="st"> "g(2)"</span>
<span class="kw"><a href="../reference/commands_string.html">commands_string</a></span>(<span class="dt">x =</span> a, <span class="dt">y =</span> b)</code></pre></div>
<pre><code>##   target command
## 1      x    f(1)
## 2      y    g(2)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">batch =<span class="st"> </span><span class="kw">c</span>(<span class="dt">x =</span> a, <span class="dt">y =</span> b)
<span class="kw"><a href="../reference/commands_batch.html">commands_batch</a></span>(batch)</code></pre></div>
<pre><code>##   target command
## 1      x    f(1)
## 2      y    g(2)</code></pre>
</div>
<div id="where-is-my-output" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#where-is-my-output" class="anchor"> </a></body></html>Where is my output?</h1>
<p>When your worflow runs, intermediate objects such as datasets, analyses, and summaries are maintained in <a href="https://github.com/richfitz/remake"><code>remake</code></a>&rsquo;s hidden <a href="https://github.com/richfitz/storr"><code>storr</code></a> cache, located in the hidden <code>.remake/objects/</code> folder. To inspect your workflow, you can list the generated objects using <code>parallelRemake::recallable()</code> and load objects using <code>parallelRemake::recall()</code>. After running the <a href="https://github.com/wlandau/remakeGenerator/tree/master/inst/examples/basic">basic example</a>, we see the following.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">&gt;<span class="st"> </span><span class="kw">library</span>(parallelRemake)
&gt;<span class="st"> </span><span class="kw">recallable</span>()
 [<span class="dv">1</span>] <span class="st">"coef"</span>                     <span class="st">"coef_linear_normal16"</span>    
 [<span class="dv">3</span>] <span class="st">"coef_linear_poisson32"</span>    <span class="st">"coef_linear_poisson64"</span>   
 [<span class="dv">5</span>] <span class="st">"coef_quadratic_normal16"</span>  <span class="st">"coef_quadratic_poisson32"</span>
 [<span class="dv">7</span>] <span class="st">"coef_quadratic_poisson64"</span> <span class="st">"linear_normal16"</span>         
 [<span class="dv">9</span>] <span class="st">"linear_poisson32"</span>         <span class="st">"linear_poisson64"</span>        
[<span class="dv">11</span>] <span class="st">"mse"</span>                      <span class="st">"mse_linear_normal16"</span>     
[<span class="dv">13</span>] <span class="st">"mse_linear_poisson32"</span>     <span class="st">"mse_linear_poisson64"</span>    
[<span class="dv">15</span>] <span class="st">"mse_quadratic_normal16"</span>   <span class="st">"mse_quadratic_poisson32"</span> 
[<span class="dv">17</span>] <span class="st">"mse_quadratic_poisson64"</span>  <span class="st">"normal16"</span>                
[<span class="dv">19</span>] <span class="st">"poisson32"</span>                <span class="st">"poisson64"</span>               
[<span class="dv">21</span>] <span class="st">"quadratic_normal16"</span>       <span class="st">"quadratic_poisson32"</span>     
[<span class="dv">23</span>] <span class="st">"quadratic_poisson64"</span>   
&gt;<span class="st"> </span><span class="kw">recall</span>(<span class="st">"normal16"</span>)
            x        y
<span class="dv">1</span>   <span class="fl">1.5500328</span> <span class="fl">4.226192</span>
<span class="dv">2</span>   <span class="fl">1.4714371</span> <span class="fl">4.374820</span>
<span class="dv">3</span>   <span class="fl">0.4906371</span> <span class="fl">6.228053</span>
<span class="dv">4</span>   <span class="fl">1.0086720</span> <span class="fl">4.945609</span>
<span class="dv">5</span>   <span class="fl">1.3360642</span> <span class="fl">5.619259</span>
<span class="dv">6</span>   <span class="fl">1.4899272</span> <span class="fl">4.920836</span>
<span class="dv">7</span>   <span class="fl">0.7046544</span> <span class="fl">4.926668</span>
<span class="dv">8</span>   <span class="fl">1.4092923</span> <span class="fl">4.030779</span>
<span class="dv">9</span>   <span class="fl">2.5636956</span> <span class="fl">6.026149</span>
<span class="dv">10</span> -<span class="fl">0.5202316</span> <span class="fl">4.368160</span>
<span class="dv">11</span>  <span class="fl">0.5540340</span> <span class="fl">4.760691</span>
<span class="dv">12</span>  <span class="fl">1.6256007</span> <span class="fl">4.722436</span>
<span class="dv">13</span>  <span class="fl">1.3210316</span> <span class="fl">3.838017</span>
<span class="dv">14</span>  <span class="fl">0.8247446</span> <span class="fl">2.708511</span>
<span class="dv">15</span>  <span class="fl">2.7262725</span> <span class="fl">5.878415</span>
<span class="dv">16</span>  <span class="fl">2.3565342</span> <span class="fl">4.445811</span>
&gt;<span class="st"> </span>out =<span class="st"> </span><span class="kw">recall</span>(<span class="st">"normal16"</span>, <span class="st">"poisson32"</span>)
&gt;<span class="st"> </span><span class="kw">str</span>(out)
List of <span class="dv">2</span>
 $<span class="st"> </span>normal16 :<span class="st">'data.frame'</span>:<span class="st">  </span><span class="dv">16</span> obs. of  <span class="dv">2</span> variables:
<span class="st">  </span>..$<span class="st"> </span>x:<span class="st"> </span>num [<span class="dv">1</span>:<span class="dv">16</span>] <span class="fl">0.9728</span> <span class="fl">1.0688</span> <span class="fl">1.4152</span> -<span class="fl">0.4313</span> <span class="fl">0.0912</span> ...
  ..$<span class="st"> </span>y:<span class="st"> </span>num [<span class="dv">1</span>:<span class="dv">16</span>] <span class="fl">6.76</span> <span class="fl">6.48</span> <span class="fl">5.59</span> <span class="fl">5.03</span> <span class="fl">3.01</span> ...
 $<span class="st"> </span>poisson32:<span class="st">'data.frame'</span>:<span class="st">  </span><span class="dv">32</span> obs. of  <span class="dv">2</span> variables:
<span class="st">  </span>..$<span class="st"> </span>x:<span class="st"> </span>int [<span class="dv">1</span>:<span class="dv">32</span>] <span class="dv">0</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">2</span> <span class="dv">1</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">1</span> ...
  ..$<span class="st"> </span>y:<span class="st"> </span>int [<span class="dv">1</span>:<span class="dv">32</span>] <span class="dv">4</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">4</span> <span class="dv">3</span> <span class="dv">7</span> <span class="dv">4</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">2</span> ...</code></pre></div>
<p>The functions <code>create_bindings()</code> and <code>make_environment()</code> are alternatives from <a href="https://github.com/richfitz/remake"><code>remake</code></a> itself. Just be careful with <code>create_bindings()</code> if your project has a lot of data.</p>
<p><strong>Do not use <code>recall()</code> or <code>recallable()</code> in serious production-level workflows because operations on the <a href="https://github.com/richfitz/storr"><code>storr</code></a> cache are not reproducibly tracked.</strong></p>
</div>
<div id="high-performance-computing" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#high-performance-computing" class="anchor"> </a></body></html>High-performance computing</h1>
<p>If you want to run <code>make -j</code> to distribute tasks over multiple nodes of a <a href="http://slurm.schedmd.com/">Slurm</a> cluster, you should generate a Makefile like the one in <a href="http://plindenbaum.blogspot.com/2014/09/parallelizing-gnu-make-4-in-slurm.html">this post</a>. To do this, run the following in an R session</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/workflow.html">workflow</a></span>(..., 
  <span class="dt">begin =</span> <span class="kw">c</span>(
    <span class="st">"SHELL=srun"</span>,
    <span class="st">".SHELLFLAGS= &lt;ARGS&gt; bash -c"</span>))</code></pre></div>
<p>where <code>&lt;ARGS&gt;</code> stands for additional arguments to <code>srun</code>. Then, once the <a href="https://www.gnu.org/software/make/">Makefile</a> is generated, you distribute the work over <code>[N]</code> simultaneous jobs by running the following in the <a href="http://linuxcommand.org/">Linux command line</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nohup nice -<span class="dv">19</span> make -j [N] &amp;</code></pre></div>
<p>For other task managers such as <a href="https://en.wikipedia.org/wiki/Portable_Batch_System">PBS</a>, you may have to create a custom stand-in for a shell. For example, suppose we are using the Univa Grid Engine. From R, call</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/workflow.html">workflow</a></span>(.., <span class="dt">begin =</span> <span class="st">"SHELL = ./shell.sh"</span>)</code></pre></div>
<p>where the file <code>shell.sh</code> contains</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#!/bin/bash</span>
shift
echo <span class="st">"module load R; $*"</span> |<span class="st"> </span>qsub -sync y -cwd -j y</code></pre></div>
<p>Now, in the Linux command line, enable execution with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">chmod +x shell.sh</code></pre></div>
<p>and then distribute the work over <code>[N]</code> simultaneous jobs with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nohup nice -<span class="dv">19</span> make -j [N] &amp;</code></pre></div>
<p>Regardless of the system, be sure that all nodes point to the same working directory so that they share the same <code>.remake</code> <a href="https://github.com/richfitz/storr">storr</a> cache. For the Univa Grid Engine, the <code>-cwd</code> flag for <code>qsub</code> accomplishes this.</p>
</div>
<div id="downsize" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#downsize" class="anchor"> </a></body></html>downsize</h1>
<p>You can use the <a href="https://CRAN.R-project.org/package=downsize"><code>downsize</code></a> package in conjunction with <code>remakeGenerator</code>. First, write an R script (say, <code>downsize.R</code>) to set test or production mode.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># downsize::test_mode()</span>
downsize::<span class="kw">production_mode</span>()</code></pre></div>
<p>Load <code>downsize.R</code> into <a href="https://github.com/wlandau/remakeGenerator/blob/master/inst/examples/basic/workflow.R"><code>workflow.R</code></a> to make your analysis plan respond to <code>downsize()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(remakeGenerator)
<span class="kw">source</span>(<span class="st">"downsize.R"</span>)
datasets =<span class="st"> </span><span class="kw"><a href="../reference/commands_string.html">commands_string</a></span>(
  <span class="dt">target =</span> <span class="st">"data1"</span>,
  <span class="dt">command =</span> <span class="kw">paste0</span>(<span class="st">"long_job(number_of_samples = "</span>, <span class="kw">downsize</span>(<span class="dv">1000</span>, <span class="dv">2</span>), <span class="st">")"</span>)
)</code></pre></div>
<p>If your custom <a href="https://github.com/wlandau/remakeGenerator/blob/master/inst/examples/basic/code.R"><code>code.R</code></a> functions call <code>downsize()</code> internally, <a href="https://github.com/richfitz/remake"><code>remake</code></a> needs to know.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/workflow.html">workflow</a></span>(<span class="dt">sources =</span> <span class="kw">c</span>(<span class="st">"downsize.R"</span>, <span class="st">"code.R"</span>, ...), <span class="dt">packages =</span> <span class="kw">c</span>(<span class="st">"downsize"</span>, ...))</code></pre></div>
<p>Unfortunately, <a href="https://github.com/richfitz/remake"><code>remake</code></a> does not rebuild targets in response to changes to global options, so you should manually run <code>remake::make("clean")</code> to start from scratch whenever you change <code>downsize.R</code>.</p>
</div>
<div id="flexibility" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#flexibility" class="anchor"> </a></body></html>Flexibility</h1>
<p>Some workflows do not fit the rigid structure of the <a href="https://github.com/wlandau/remakeGenerator/tree/master/inst/examples/basic">basic example</a> but could still benefit from the automated generation of <a href="https://github.com/richfitz/remake"><code>remake.yml</code></a> files and <a href="https://www.gnu.org/software/make/">Makefiles</a>. If you supply the appropriate data frames to the <code><a href="../reference/targets.html">targets()</a></code> function, you can customize your own analyses. Here, the <code><a href="../reference/expand.html">expand()</a></code> and <code><a href="../reference/evaluate.html">evaluate()</a></code> functions are essential to flexibility. The <code><a href="../reference/expand.html">expand()</a></code> function replicates targets generated by the same commands, and the <code><a href="../reference/evaluate.html">evaluate()</a></code> function lets you create and evaluate your own wildcard placeholders. With the <code>rules</code> argument, the <code><a href="../reference/evaluate.html">evaluate()</a></code> funcion is also capable of evaluating multiple wildcards in a single function call. (In this case, <code>rules</code> takes precedence, and the <code>wildcard</code> and <code>values</code> arguments are ignored.) Here are some examples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df =<span class="st"> </span><span class="kw"><a href="../reference/commands.html">commands</a></span>(<span class="dt">data =</span> <span class="kw">simulate</span>(<span class="dt">center =</span> MU, <span class="dt">scale =</span> SIGMA))
df</code></pre></div>
<pre><code>##   target                              command
## 1   data simulate(center = MU, scale = SIGMA)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df =<span class="st"> </span><span class="kw"><a href="../reference/expand.html">expand</a></span>(df, <span class="dt">values =</span> <span class="kw">c</span>(<span class="st">"rep1"</span>, <span class="st">"rep2"</span>))
df</code></pre></div>
<pre><code>##      target                              command
## 1 data_rep1 simulate(center = MU, scale = SIGMA)
## 2 data_rep2 simulate(center = MU, scale = SIGMA)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/evaluate.html">evaluate</a></span>(df, <span class="dt">wildcard =</span> <span class="st">"MU"</span>, <span class="dt">values =</span> <span class="dv">1</span>:<span class="dv">2</span>)</code></pre></div>
<pre><code>##        target                             command
## 1 data_rep1_1 simulate(center = 1, scale = SIGMA)
## 2 data_rep1_2 simulate(center = 2, scale = SIGMA)
## 3 data_rep2_1 simulate(center = 1, scale = SIGMA)
## 4 data_rep2_2 simulate(center = 2, scale = SIGMA)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/evaluate.html">evaluate</a></span>(df, <span class="dt">wildcard =</span> <span class="st">"MU"</span>, <span class="dt">values =</span> <span class="dv">1</span>:<span class="dv">2</span>, <span class="dt">expand =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##      target                             command
## 1 data_rep1 simulate(center = 1, scale = SIGMA)
## 2 data_rep2 simulate(center = 2, scale = SIGMA)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/evaluate.html">evaluate</a></span>(df, <span class="dt">rules =</span> <span class="kw">list</span>(<span class="dt">MU =</span> <span class="dv">1</span>:<span class="dv">2</span>, <span class="dt">SIGMA =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>)), <span class="dt">expand =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>##      target                           command
## 1 data_rep1 simulate(center = 1, scale = 0.1)
## 2 data_rep2   simulate(center = 2, scale = 1)</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/evaluate.html">evaluate</a></span>(df, <span class="dt">rules =</span> <span class="kw">list</span>(<span class="dt">MU =</span> <span class="dv">1</span>:<span class="dv">2</span>, <span class="dt">SIGMA =</span> <span class="kw">c</span>(<span class="fl">0.1</span>, <span class="dv">1</span>, <span class="dv">10</span>)))</code></pre></div>
<pre><code>##             target                           command
## 1  data_rep1_1_0.1 simulate(center = 1, scale = 0.1)
## 2    data_rep1_1_1   simulate(center = 1, scale = 1)
## 3   data_rep1_1_10  simulate(center = 1, scale = 10)
## 4  data_rep1_2_0.1 simulate(center = 2, scale = 0.1)
## 5    data_rep1_2_1   simulate(center = 2, scale = 1)
## 6   data_rep1_2_10  simulate(center = 2, scale = 10)
## 7  data_rep2_1_0.1 simulate(center = 1, scale = 0.1)
## 8    data_rep2_1_1   simulate(center = 1, scale = 1)
## 9   data_rep2_1_10  simulate(center = 1, scale = 10)
## 10 data_rep2_2_0.1 simulate(center = 2, scale = 0.1)
## 11   data_rep2_2_1   simulate(center = 2, scale = 1)
## 12  data_rep2_2_10  simulate(center = 2, scale = 10)</code></pre>
<p>For another demonstration, see the <a href="https://github.com/wlandau/remakeGenerator/tree/master/inst/examples/flexible">flexible example</a>, which almost the same as the <a href="https://github.com/wlandau/remakeGenerator/tree/master/inst/examples/basic">basic example</a> except that it uses <code><a href="../reference/expand.html">expand()</a></code> and <code><a href="../reference/evaluate.html">evaluate()</a></code> explicitly.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked"><li><a href="#rtools-for-windows-users">Rtools for Windows users</a></li>
      <li><a href="#help-and-troubleshooting">Help and troubleshooting</a></li>
      <li><a href="#basic-example">Basic example</a></li>
      <li><a href="#a-walk-through-workflow.r">A walk through </a><a href="https://github.com/wlandau/remakeGenerator/blob/master/inst/examples/basic/workflow.R"><code>workflow.R</code></a></li>
      <li><a href="#running-intermediate-stages">Running intermediate stages</a></li>
      <li><a href="#the-framework">The framework</a></li>
      <li><a href="#the-commands-functions">The &ldquo;commands&rdquo; functions</a></li>
      <li><a href="#where-is-my-output">Where is my output?</a></li>
      <li><a href="#high-performance-computing">High-performance computing</a></li>
      <li><a href="#downsize">downsize</a></li>
      <li><a href="#flexibility">Flexibility</a></li>
      </ul></div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by William Michael Landau.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer></div>

  </body></html>
